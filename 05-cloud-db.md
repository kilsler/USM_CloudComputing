# Лабораторная работа №5. Облачные базы данных. Amazon RDS, DynamoDB
## Цель работы

Целью работы является ознакомиться с сервисами Amazon RDS (Relational Database Service) и Amazon DynamoDB, а также научиться:

    Создавать и настраивать экземпляры реляционных баз данных в облаке AWS с использованием Amazon RDS.
    Понимать концепцию Read Replicas и применять их для повышения производительности и отказоустойчивости баз данных.
    Подключаться к базе данных Amazon RDS с виртуальной машины EC2 и выполнять базовые операции с данными (создание, чтение, обновление, удаление записей - CRUD).
    (Дополнительно) Ознакомиться с сервисом Amazon DynamoDB и освоить работу с хранением данных в NoSQL-формате.

## Выполнение работы

### Шаг 1. Подготовка среды (VPC/подсети/SG)

    Создайте VPC (project-vpc) с двумя публичными и двумя приватными подсетями в разных зонах доступности (AZ). В данной подсети будут развернуты ваши базы данных и приложение.
        Для создания подсетей воспользуйтесь мастером создания VPC (Create VPC -> VPC and more) в консоли AWS или используйте VPC созданную в 3 лабораторной работе.
    Создайте группу безопасности (web-security-group) для вашего приложения, разрешающий следующий трафик:
        Входящий: HTTP (порт 80) от любого источника;
        Входящий: SSH (порт 22) от вашего IP-адреса или от любого источника (для учебных целей);
    Создайте группу безопасности (db-mysql-security-group) для вашей базы данных, разрешающий следующий трафик:
        Входящий: MySQL/Aurora (порт 3306) от web-security-group (т.е. только ресурсы, принадлежащие этой группе безопасности, смогут подключаться к базе данных);
    Измените web-security-group, добавив правило для исходящего трафика:
        Исходящий: MySQL/Aurora (порт 3306) к db-mysql-security-group (т.е. ваше приложение сможет инициализировать соединение с базой данных).

### Шаг 2. Развертывание Amazon RDS

    Перейдите в консоль Amazon Aurora and RDS.

    Создайте Subnet Group для вашей базы данных.

        Что такое Subnet Group? И зачем необходимо создавать Subnet Group для базы данных?

        Название: project-rds-subnet-group
        Выберите созданный ранее VPC и добавьте 2 приватные подсети из 2 разных AZ.

    Создайте экземпляр базы данных Amazon RDS (Databases -> Create database).

    В разделе Choose a database creation method выберите Standard Create. Это позволит вам настроить все параметры базы данных вручную, что полезно для учебных целей.

    Выбераем следующие параметры базы данных:
        Engine type: MySQL
        Version: MySQL 8.0.42 (или последнюю доступную версию)
        Templater: Free tier (так как это учебная среда)
        Availability and durability: Single-AZ DB instance deployment
        DB instance identifier (название сервера базы данных): project-rds-mysql-prod
        Master username: admin (имя пользователя администратора базы данных)
        Master password введите и подтвердите пароль для пользователя администратора (обязательно запомните его, он понадобится для подключения к базе данных).
        DB instance class: Burstable classes (includes t classes), db.t3.micro (подходит для учебных целей)
        Storage:
            Storage type: General Purpose SSD (gp3)
            Allocated storage: 20 GB (минимально доступный размер для учебных целей)
            Enable storage autoscaling: Checked (это позволит базе данных автоматически увеличивать размер хранилища при необходимости)
            Maximum storage threshold: 100 GB
        Connectivity (подключение)
            Выберите Don’t connect to an EC2 compute resource
            Virtual private cloud (VPC) выберите созданный ранее VPC
            DB subnet group: выберите созданную ранее Subnet Group project-rds-subnet-group
            Public access: No (база данных не будет доступна из интернета)
            Existing VPC security groups: выберите созданную ранее группу безопасности db-mysql-security-group
            Availability zone: No preference (AWS выберет зону автоматически)
        Additional configuration
            Initial database name: project_db (название базы данных, которая будет создана при инициализации)
            Backup (Enable automated backup) поставьте галочку (для создания read replica необходимы бэкапы)
            Backup (Enable encryption) снимите галочку (для учебных целей шифрование не требуется)
            Maintanance (Enable auto minor version upgrade) снимите галочку (для учебных целей автоматическое обновление не требуется)
        Нажмите Create database для создания базы данных.

    Дождитесь завершения создания базы данных (статус должен измениться на Available).

    копируем Endpoint вашей базы данных (он понадобится для подключения).

### Шаг 3. Создание виртуальной машины для подключения к базе данных

Создаем виртуальную машину EC2 в публичной подсети вашего VPC, чтобы использовать её для подключения к базе данных RDS.

Для виртуальной машины, используем группу безопасности web-security-group, созданную ранее.

Устанавливаем скрипт для автоматического скачивания и установки mysql  
```bash
#!/bin/bash
dnf update -y
dnf install -y mariadb105
```
### Шаг 4. Подключение к базе данных и выполнение базовых операций
Подключаемся к вашей виртуальной машине EC2 по SSH.
Подключаемся к базе данных RDS с помощью MySQL клиента:

mysql -h <RDS_ENDPOINT> -u admin -p

гже, <RDS_ENDPOINT> - это скопированный ранее endpoint вашей базы данных RDS.
Введите пароль администратора базы данных, который вы указали при создании базы данных.
После успешного подключения выберите базу данных:
```sql
USE project_db;
```
### Шаг 5. Создание Read Replica

    Выберите базу данных RDS в консоли AWS.

    Нажмите на кнопку Actions и выберите Create read replica.

    Укажите следующие параметры для Read Replica:
        DB instance identifier: project-rds-mysql-read-replica
        Instance class: db.t3.micro
        Storage type: General Purpose SSD (gp3)
        Monitoring
            Enable Enhanced monitoring: снимите галочку (для учебных целей не требуется)
        Public access: No
        VPC security groups: выберите ту же группу безопасности db-mysql-security-group

    Дождитесь, пока реплика перейдёт в Available. У неё будет свой endpoint (только для чтения).

    Подключитесь к Read Replica с вашей виртуальной машины EC2 и выполните запросы на чтение данных (SELECT) из таблиц, созданных на основном экземпляре базы данных.

        Какие данные вы видите? Объясните почему.

    Попробуйте выполнить запрос на запись (INSERT/UPDATE) на реплике.

        Получилось ли выполнить запись на Read Replica? Почему?

    Перейдите на основной экземпляр базы данных и добавьте новую запись в одну из таблиц.

    Вернитесь к подключению к Read Replica и выполните запрос на чтение.

        Отобразилась ли новая запись на реплике? Объясните почему.

    Объясните, зачем нужны Read Replicas и в каких сценариях их использование будет полезным.

### Шаг 6. Подключение приложения к базе данных

Выберите один из вариантов ниже для подключения приложения к базе данных Amazon RDS и выполнения базовых операций с данными (CRUD).
#### Шаг 6a. Развертывание CRUD приложения

    Разработайте и разверните простое веб-приложение на вашей виртуальной машине Amazon EC2, которое подключается к базе данных Amazon RDS и выполняет базовые операции с данными (создание, чтение, обновление, удаление записей - CRUD).
    Настройте приложение таким образом, чтобы для операций записи и изменения данных использовался основной экземпляр (master instance), а для операций чтения - реплика для чтения (read replica).

    В данном задании достаточно разработать простое приложение с минимальным функционалом. Вы можете использовать любой язык программирования и фреймворк по вашему выбору.

#### Шаг 6b. Развертывания PHP-приложения из лабораторной работы 4

    Используйте лабораторную работу по дисциплине «Продвинутая веб-разработка (PHP)», в которой ранее применялась локальная база данных.
    Измените параметры подключения к базе данных в вашем PHP-приложении таким образом, чтобы оно подключалось к Amazon RDS вместо локальной БД.
    Выполните миграцию данных (вручную или с использованием инструментов автоматической миграции) из локальной базы данных в экземпляр Amazon RDS - при необходимости.
    Проверьте корректность работы приложения, убедившись, что оно выполняет все основные операции с данными (создание, чтение, обновление и удаление записей - CRUD) через Amazon RDS.

## Контрольные вопросы 

